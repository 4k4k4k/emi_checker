<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EMI Checker</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to bottom, #f5f7fa, #c3cfe2);
      color: #333;
      max-width: 600px;
      margin: 30px auto;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }
    h1, h3 {
      text-align: center;
      margin-bottom: 20px;
      color: #1a237e;
    }
    .step {
      display: none;
    }
    .step.active {
      display: block;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: 600;
    }
    .options {
      margin-top: 10px;
    }
    .options label {
      display: block;
      background: #fff;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      margin-bottom: 10px;
      cursor: pointer;
    }
    .options input[type="radio"] {
      margin-right: 10px;
    }
    select, input, button {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    button {
      background-color: #1a73e8;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s ease;
    }
    button:hover {
      background-color: #0d47a1;
    }
    #result, #callbackForm {
      display: none;
      margin-top: 30px;
      padding: 20px;
      border-radius: 8px;
    }
    #result {
      background: #e8f5e9;
      border-left: 6px solid #2e7d32;
    }
    #callbackForm {
      background: #fce4ec;
      border-left: 6px solid #ad1457;
    }
  </style>
</head>
<body>
  <h1>Still Paying High EMI?</h1>

  <div id="formSteps">
    <div class="step active" id="step1">
      <h3>Select Your Current Bank</h3>
      <div id="bankOptions" class="options"></div>
      <button onclick="nextStep(1)">Next</button>
    </div>

    <div class="step" id="step2">
      <h3>Select Your Credit Score</h3>
      <select id="creditScoreSelect">
        <option value="625-650">625 - 650</option>
        <option value="651-675">651 - 675</option>
        <option value="676-700">676 - 700</option>
        <option value="701-725">701 - 725</option>
        <option value="726-750">726 - 750</option>
        <option value="751-775">751 - 775</option>
        <option value="776-800">776 - 800</option>
        <option value="801-825">801 - 825</option>
        <option value="825+">825+</option>
      </select>
      <button onclick="nextStep(2)">Next</button>
    </div>

    <div class="step" id="step3">
      <h3>Enter Your Current Rate of Interest (%)</h3>
      <input type="number" id="roiInput" step="0.01" placeholder="e.g. 9.25">
      <button onclick="nextStep(3)">Next</button>
    </div>

    <div class="step" id="step4">
      <h3>Enter Your Loan Amount Remaining (in ₹ Lakhs)</h3>
      <input type="number" id="loanAmountFloat" step="0.1" placeholder="e.g. 58.5">
      <button onclick="nextStep(4)">Next</button>
    </div>

    <div class="step" id="step5">
      <h3>Enter Tenure Remaining (in Years)</h3>
      <input type="number" id="tenureFloat" step="0.1" placeholder="e.g. 12.5">
      <button onclick="nextStep(5)">Next</button>
    </div>

    <div class="step" id="step6">
      <h3>Select Your Property's Khata Type</h3>
      <div id="khataSelect" class="options"></div>
      <button onclick="calculateEMI()">Show My Savings</button>
    </div>
  </div>

  <div id="result"></div>

  <div id="callbackForm">
    <h3>Get a Call from Us</h3>
    <input type="text" placeholder="Your Name">
    <input type="email" placeholder="Your Email">
    <input type="tel" placeholder="Your Phone Number">
    <button>Submit</button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <script>
    const bankList = ["SBI", "HDFC", "ICICI", "Axis Bank", "PNB", "Bank of Baroda", "Kotak Mahindra", "Yes Bank", "IDFC First", "IndusInd Bank", "Canara Bank"];
    const fallbackKhatas = ["A Khata", "B Khata", "E Khata (11/A)", "DC Converted", "Gram Panchayat", "Non-DC"];
    const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRZVMhFCeAnYvW9_88jQll9skc_zRDnv-QO_FaPY0rDPpHBT20mcCR2XWzvKaos8X3RD5OH_Y83t1Z5/pub?output=csv';

    window.onload = function() {
      const bankOptions = document.getElementById("bankOptions");
      bankList.forEach(bank => {
        const label = document.createElement("label");
        label.innerHTML = `<input type='radio' name='bank' value='${bank}'> ${bank}`;
        bankOptions.appendChild(label);
      });

      Papa.parse(sheetUrl, {
        download: true,
        header: true,
        complete: function(results) {
          const bankData = results.data.filter(row => row["Bank"]);
          window.bankData = bankData;
          let khatas = [...new Set(bankData.map(row => row["Khata Type"]).filter(Boolean))];

          if (khatas.length === 0) khatas = fallbackKhatas;

          const khataSelect = document.getElementById("khataSelect");
          khataSelect.innerHTML = '';
          khatas.forEach(khata => {
            const label = document.createElement("label");
            label.innerHTML = `<input type='radio' name='khata' value='${khata}'> ${khata}`;
            khataSelect.appendChild(label);
          });
        }
      });
    };

    function nextStep(current) {
      document.getElementById(`step${current}`).classList.remove("active");
      document.getElementById(`step${current + 1}`).classList.add("active");
    }

    function calculateEMI() {
      const selectedBank = document.querySelector("input[name='bank']:checked")?.value;
      const creditScore = document.getElementById("creditScoreSelect").value;
      const currentROI = parseFloat(document.getElementById("roiInput").value);
      const loanAmount = parseFloat(document.getElementById("loanAmountFloat").value) * 100000;
      const tenureYears = parseFloat(document.getElementById("tenureFloat").value);
      const selectedKhata = document.querySelector("input[name='khata']:checked")?.value;

      const filteredBanks = window.bankData.filter(row => row["Khata Type"] === selectedKhata);
      const bestBank = filteredBanks.reduce((min, row) => {
        const roi = parseFloat(row["Rate of Interest"].replace('%', ''));
        return roi < min.roi ? { bank: row["Bank"], roi } : min;
      }, { bank: null, roi: Infinity });

      const resultDiv = document.getElementById("result");
      const months = tenureYears * 12;

      const currentEMI = (loanAmount * currentROI / 1200) / (1 - Math.pow(1 + currentROI / 1200, -months));
      const newEMI = (loanAmount * bestBank.roi / 1200) / (1 - Math.pow(1 + bestBank.roi / 1200, -months));
      const savings = (currentEMI - newEMI) * months;

      resultDiv.innerHTML = `
        <h3>Your Result</h3>
        <p><b>Current EMI:</b> ₹${currentEMI.toFixed(2)}</p>
        <p><b>Best Available Bank for your Khata Type:</b> ${bestBank.bank}</p>
        <p><b>New EMI:</b> ₹${newEMI.toFixed(2)}</p>
        <p><b>Total Savings:</b> ₹${savings.toFixed(2)}</p>
      `;

      document.getElementById("formSteps").style.display = 'none';
      resultDiv.style.display = 'block';
      document.getElementById("callbackForm").style.display = 'block';
    }
  </script>
</body>
</html>
