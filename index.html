<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EMI Checker</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to bottom, #f5f7fa, #c3cfe2);
      color: #333;
      max-width: 600px;
      margin: 30px auto;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }
    h1, h3 {
      text-align: center;
      margin-bottom: 20px;
      color: #1a237e;
    }
    .step {
      display: none;
    }
    .step.active {
      display: block;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: 600;
    }
    .options {
      margin-top: 10px;
    }
    .options label {
      display: block;
      background: #fff;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      margin-bottom: 10px;
      cursor: pointer;
    }
    .options input[type="radio"] {
      margin-right: 10px;
    }
    select, input, button {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    button {
      background-color: #1a73e8;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s ease;
    }
    button:hover {
      background-color: #0d47a1;
    }
    #result, #callbackForm {
      display: none;
      margin-top: 30px;
      padding: 20px;
      border-radius: 8px;
    }
    #result {
      background: #e8f5e9;
      border-left: 6px solid #2e7d32;
    }
    #callbackForm {
      background: #fce4ec;
      border-left: 6px solid #ad1457;
    }
  </style>
</head>
<body>
  <h1>Still Paying High EMI?</h1>

  <!-- FORM FLOW OMITTED FOR BREVITY -->

  <script>
    const bankList = ["SBI", "HDFC", "ICICI", "Axis Bank", "PNB", "Bank of Baroda", "Kotak Mahindra", "Yes Bank", "IDFC First", "IndusInd Bank", "Canara Bank"];
    const fallbackKhatas = ["A Khata", "B Khata", "E Khata (11/A)", "DC Converted", "Gram Panchayat", "Non-DC"];
    const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRZVMhFCeAnYvW9_88jQll9skc_zRDnv-QO_FaPY0rDPpHBT20mcCR2XWzvKaos8X3RD5OH_Y83t1Z5/pub?output=csv';

    window.onload = function() {
      const bankOptions = document.getElementById("bankOptions");
      bankList.forEach(bank => {
        const label = document.createElement("label");
        label.innerHTML = `<input type='radio' name='bank' value='${bank}'> ${bank}`;
        bankOptions.appendChild(label);
      });

      Papa.parse(sheetUrl, {
        download: true,
        header: true,
        complete: function(results) {
          const bankData = results.data.filter(row => row["Bank"]);
          window.bankData = bankData;
          let khatas = [...new Set(bankData.map(row => row["Khata Type"]).filter(Boolean))];

          if (khatas.length === 0) khatas = fallbackKhatas;

          const khataSelect = document.getElementById("khataSelect");
          khataSelect.innerHTML = '';
          khatas.forEach(khata => {
            const label = document.createElement("label");
            label.innerHTML = `<input type='radio' name='khata' value='${khata}'> ${khata}`;
            label.classList.add("options");
            khataSelect.appendChild(label);
          });
        }
      });
    };

    function calculateEMI() {
      const selectedBank = document.querySelector("input[name='bank']:checked")?.value;
      const creditScore = document.getElementById("creditScoreSelect").value;
      const currentROI = parseFloat(document.getElementById("roiInput").value);
      const loanAmount = parseFloat(document.getElementById("loanAmountFloat").value) * 100000;
      const tenureYears = parseFloat(document.getElementById("tenureFloat").value);
      const selectedKhata = document.querySelector("input[name='khata']:checked")?.value;

      const filteredBanks = window.bankData.filter(row => row["Khata Type"] === selectedKhata);
      const bestBank = filteredBanks.reduce((min, row) => {
        const roi = parseFloat(row["Rate of Interest"].replace('%', ''));
        return roi < min.roi ? { bank: row["Bank"], roi } : min;
      }, { bank: null, roi: Infinity });

      const resultDiv = document.getElementById("result");
      const months = tenureYears * 12;

      const currentEMI = (loanAmount * currentROI / 1200) / (1 - Math.pow(1 + currentROI / 1200, -months));
      const newEMI = (loanAmount * bestBank.roi / 1200) / (1 - Math.pow(1 + bestBank.roi / 1200, -months));
      const savings = (currentEMI - newEMI) * months;

      resultDiv.innerHTML = `
        <h3>Your Result</h3>
        <p><b>Current EMI:</b> ₹${currentEMI.toFixed(2)}</p>
        <p><b>Best Available Bank for your Khata Type:</b> ${bestBank.bank}</p>
        <p><b>New EMI:</b> ₹${newEMI.toFixed(2)}</p>
        <p><b>Total Savings:</b> ₹${savings.toFixed(2)}</p>
      `;

      document.getElementById("formSteps").style.display = 'none';
      resultDiv.style.display = 'block';
      document.getElementById("callbackForm").style.display = 'block';
    }
  </script>
</body>
</html>
